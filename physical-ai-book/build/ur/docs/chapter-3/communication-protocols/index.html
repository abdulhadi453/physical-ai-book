<!doctype html>
<html lang="ur" dir="rtl" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-chapter-3/communication-protocols" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">AI-Robot Communication Protocols for Isaac Sim | AI-Native Textbook for Physical AI &amp; Humanoid Robotics</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://physical-ai-book.github.io/ur/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://physical-ai-book.github.io/ur/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://physical-ai-book.github.io/ur/docs/chapter-3/communication-protocols"><meta data-rh="true" property="og:locale" content="ur"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" name="docusaurus_locale" content="ur"><meta data-rh="true" name="docsearch:language" content="ur"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="AI-Robot Communication Protocols for Isaac Sim | AI-Native Textbook for Physical AI &amp; Humanoid Robotics"><meta data-rh="true" name="description" content="Overview"><meta data-rh="true" property="og:description" content="Overview"><link data-rh="true" rel="icon" href="/ur/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://physical-ai-book.github.io/ur/docs/chapter-3/communication-protocols"><link data-rh="true" rel="alternate" href="https://physical-ai-book.github.io/docs/chapter-3/communication-protocols" hreflang="en"><link data-rh="true" rel="alternate" href="https://physical-ai-book.github.io/ur/docs/chapter-3/communication-protocols" hreflang="ur"><link data-rh="true" rel="alternate" href="https://physical-ai-book.github.io/docs/chapter-3/communication-protocols" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"AI-Robot Communication Protocols for Isaac Sim","item":"https://physical-ai-book.github.io/ur/docs/chapter-3/communication-protocols"}]}</script><link rel="alternate" type="application/rss+xml" href="/ur/blog/rss.xml" title="AI-Native Textbook for Physical AI &amp; Humanoid Robotics RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/ur/blog/atom.xml" title="AI-Native Textbook for Physical AI &amp; Humanoid Robotics Atom Feed"><link rel="stylesheet" href="/ur/assets/css/styles.00a4f8ad.css">
<script src="/ur/assets/js/runtime~main.1140a14f.js" defer="defer"></script>
<script src="/ur/assets/js/main.f6501a17.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/ur/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/ur/"><div class="navbar__logo"><img src="/ur/img/logo.svg" alt="Physical AI Book Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/ur/img/logo.svg" alt="Physical AI Book Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Physical AI &amp; Humanoid Robotics</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/ur/docs/intro">Chapters</a><a class="navbar__item navbar__link" href="/ur/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/physical-ai-book/hackathon-book" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/ur/docs/intro"><span title="Introduction to Physical AI &amp; Humanoid Robotics" class="linkLabel_WmDU">Introduction to Physical AI &amp; Humanoid Robotics</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/ur/docs/chapter-1/intro"><span title="Module 1: The Robotic Nervous System (ROS 2)" class="categoryLinkLabel_W154">Module 1: The Robotic Nervous System (ROS 2)</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/ur/docs/chapter-2/intro"><span title="Module 2: The Digital Twin (Gazebo &amp; Unity)" class="categoryLinkLabel_W154">Module 2: The Digital Twin (Gazebo &amp; Unity)</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/ur/docs/chapter-3/intro"><span title="Module 3: The AI-Robot Brain (NVIDIA Isaac™)" class="categoryLinkLabel_W154">Module 3: The AI-Robot Brain (NVIDIA Isaac™)</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/ur/docs/chapter-3/intro"><span title="Chapter 3.1: NVIDIA Isaac Platform Integration" class="categoryLinkLabel_W154">Chapter 3.1: NVIDIA Isaac Platform Integration</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/ur/docs/chapter-3/setup"><span title="Chapter 3.2: System Setup and Configuration" class="categoryLinkLabel_W154">Chapter 3.2: System Setup and Configuration</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/ur/docs/chapter-3/perception-pipeline"><span title="Chapter 3.3: Advanced Implementation" class="categoryLinkLabel_W154">Chapter 3.3: Advanced Implementation</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ur/docs/chapter-3/perception-pipeline"><span title="Isaac ROS Perception Pipeline Implementation" class="linkLabel_WmDU">Isaac ROS Perception Pipeline Implementation</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ur/docs/chapter-3/sensor-integration"><span title="Multimodal Sensor Integration in Isaac Sim" class="linkLabel_WmDU">Multimodal Sensor Integration in Isaac Sim</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ur/docs/chapter-3/model-deployment"><span title="AI Model Deployment in Isaac Sim Environment" class="linkLabel_WmDU">AI Model Deployment in Isaac Sim Environment</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ur/docs/chapter-3/exercises"><span title="Module 3 Exercise Framework: The AI-Robot Brain (NVIDIA Isaac™)" class="linkLabel_WmDU">Module 3 Exercise Framework: The AI-Robot Brain (NVIDIA Isaac™)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ur/docs/chapter-3/assessments"><span title="Module 3 Assessments: The AI-Robot Brain (NVIDIA Isaac™)" class="linkLabel_WmDU">Module 3 Assessments: The AI-Robot Brain (NVIDIA Isaac™)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ur/docs/chapter-3/assessment"><span title="Module 3 Assessment: The AI-Robot Brain (NVIDIA Isaac™)" class="linkLabel_WmDU">Module 3 Assessment: The AI-Robot Brain (NVIDIA Isaac™)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ur/docs/chapter-3/progress-tracking-guide"><span title="Progress Tracking Guide: Module 3 - The AI-Robot Brain (NVIDIA Isaac™)" class="linkLabel_WmDU">Progress Tracking Guide: Module 3 - The AI-Robot Brain (NVIDIA Isaac™)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ur/docs/chapter-3/educator-guide"><span title="Educator Guide: Module 3 - The AI-Robot Brain (NVIDIA Isaac™)" class="linkLabel_WmDU">Educator Guide: Module 3 - The AI-Robot Brain (NVIDIA Isaac™)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ur/docs/chapter-3/researcher-resources"><span title="Researcher Resources: Module 3 - The AI-Robot Brain (NVIDIA Isaac™)" class="linkLabel_WmDU">Researcher Resources: Module 3 - The AI-Robot Brain (NVIDIA Isaac™)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/ur/docs/chapter-3/communication-protocols"><span title="AI-Robot Communication Protocols for Isaac Sim" class="linkLabel_WmDU">AI-Robot Communication Protocols for Isaac Sim</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ur/docs/chapter-3/safety-framework"><span title="Safety and Reliability Framework for Isaac Sim AI-Robot Systems" class="linkLabel_WmDU">Safety and Reliability Framework for Isaac Sim AI-Robot Systems</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ur/docs/chapter-3/performance-monitoring"><span title="Performance Monitoring Tools for Isaac Sim AI-Robot Systems" class="linkLabel_WmDU">Performance Monitoring Tools for Isaac Sim AI-Robot Systems</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/ur/docs/chapter-3/summary"><span title="Module 3 Summary: The AI-Robot Brain (NVIDIA Isaac™)" class="linkLabel_WmDU">Module 3 Summary: The AI-Robot Brain (NVIDIA Isaac™)</span></a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/ur/docs/chapter-4/intro"><span title="Module 4: Vision-Language-Action (VLA) Systems" class="categoryLinkLabel_W154">Module 4: Vision-Language-Action (VLA) Systems</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/ur/docs/contributing"><span title="Contributing" class="linkLabel_WmDU">Contributing</span></a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/ur/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Module 3: The AI-Robot Brain (NVIDIA Isaac™)</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Chapter 3.3: Advanced Implementation</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">AI-Robot Communication Protocols for Isaac Sim</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>AI-Robot Communication Protocols for Isaac Sim</h1></header>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview" translate="no">​</a></h2>
<p>This document provides comprehensive guidelines for implementing AI-robot communication protocols in the NVIDIA Isaac Sim environment for Module 3. The focus is on establishing efficient, reliable, and secure communication between AI systems and robotic platforms using the Isaac ROS bridge.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="introduction-to-ai-robot-communication">Introduction to AI-Robot Communication<a href="#introduction-to-ai-robot-communication" class="hash-link" aria-label="Direct link to Introduction to AI-Robot Communication" title="Direct link to Introduction to AI-Robot Communication" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="what-is-ai-robot-communication">What is AI-Robot Communication?<a href="#what-is-ai-robot-communication" class="hash-link" aria-label="Direct link to What is AI-Robot Communication?" title="Direct link to What is AI-Robot Communication?" translate="no">​</a></h3>
<p>AI-robot communication involves the exchange of data and commands between artificial intelligence systems and robotic platforms. In the Isaac Sim context, this includes:</p>
<ul>
<li class=""><strong>Perception Data</strong>: Camera images, LiDAR scans, sensor readings</li>
<li class=""><strong>Control Commands</strong>: Movement commands, actuator controls</li>
<li class=""><strong>State Information</strong>: Robot pose, sensor status, system health</li>
<li class=""><strong>AI Decisions</strong>: Navigation goals, action plans, behavioral commands</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="key-communication-principles">Key Communication Principles<a href="#key-communication-principles" class="hash-link" aria-label="Direct link to Key Communication Principles" title="Direct link to Key Communication Principles" translate="no">​</a></h3>
<ol>
<li class=""><strong>Reliability</strong>: Ensuring data integrity and delivery</li>
<li class=""><strong>Timeliness</strong>: Meeting real-time performance requirements</li>
<li class=""><strong>Efficiency</strong>: Optimizing bandwidth and processing resources</li>
<li class=""><strong>Security</strong>: Protecting communication channels</li>
<li class=""><strong>Scalability</strong>: Supporting multiple robots and AI agents</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="isaac-ros-communication-architecture">Isaac ROS Communication Architecture<a href="#isaac-ros-communication-architecture" class="hash-link" aria-label="Direct link to Isaac ROS Communication Architecture" title="Direct link to Isaac ROS Communication Architecture" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-creating-communication-protocol-configuration">1. Creating Communication Protocol Configuration<a href="#1-creating-communication-protocol-configuration" class="hash-link" aria-label="Direct link to 1. Creating Communication Protocol Configuration" title="Direct link to 1. Creating Communication Protocol Configuration" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat &gt; ~/isaac_sim_shared/configs/communication_config.yaml &lt;&lt; &#x27;EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># AI-Robot Communication Protocol Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">communication:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # General communication settings</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  qos_profiles:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sensor_data:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      reliability: reliable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      durability: volatile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      history: keep_last</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      depth: 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    control_commands:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      reliability: reliable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      durability: transient_local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      history: keep_last</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      depth: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    status_updates:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      reliability: best_effort</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      durability: volatile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      history: keep_last</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      depth: 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Topic configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  topics:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    perception:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      camera:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        topic: &quot;/camera/color/image_raw&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        qos: &quot;sensor_data&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        frequency: 30.0  # Hz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        compression: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      depth:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        topic: &quot;/camera/depth/image_rect_raw&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        qos: &quot;sensor_data&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        frequency: 30.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        compression: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      lidar:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        topic: &quot;/scan&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        qos: &quot;sensor_data&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        frequency: 10.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        compression: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      imu:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        topic: &quot;/imu&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        qos: &quot;sensor_data&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        frequency: 100.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        compression: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    control:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      velocity:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        topic: &quot;/cmd_vel&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        qos: &quot;control_commands&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        frequency: 50.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        priority: high</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      joints:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        topic: &quot;/joint_commands&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        qos: &quot;control_commands&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        frequency: 100.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        priority: high</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    status:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      odometry:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        topic: &quot;/odom&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        qos: &quot;status_updates&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        frequency: 50.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      battery:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        topic: &quot;/battery_state&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        qos: &quot;status_updates&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        frequency: 1.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      tf:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        topic: &quot;/tf&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        qos: &quot;status_updates&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        frequency: 50.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Communication optimization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  optimization:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enable_compression: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compression_level: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    message_coalescing: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bandwidth_limit: 100.0  # Mbps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    message_buffer_size: 1024  # bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Security settings</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  security:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enable_encryption: false  # For simulation environment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enable_authentication: false  # For simulation environment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    encryption_algorithm: &quot;AES-256&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    authentication_method: &quot;RSA-2048&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Performance monitoring</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  monitoring:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enable_profiling: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    profile_output: &quot;/workspace/shared_dir/logs/communication_profile.json&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enable_bandwidth_monitoring: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enable_latency_monitoring: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enable_packet_loss_monitoring: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Error handling and recovery</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  error_handling:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    max_retries: 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    retry_delay: 0.1  # seconds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    timeout: 1.0  # seconds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    heartbeat_interval: 5.0  # seconds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    failure_threshold: 5  # consecutive failures before recovery</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-creating-communication-protocol-node">2. Creating Communication Protocol Node<a href="#2-creating-communication-protocol-node" class="hash-link" aria-label="Direct link to 2. Creating Communication Protocol Node" title="Direct link to 2. Creating Communication Protocol Node" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat &gt; ~/isaac_ros_ws/src/isaac_communication_protocol/communication_protocol/protocol_handler.py &lt;&lt; &#x27;EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#!/usr/bin/env python3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import rclpy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from rclpy.node import Node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from rclpy.qos import QoSProfile, ReliabilityPolicy, DurabilityPolicy, HistoryPolicy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from sensor_msgs.msg import Image, LaserScan, Imu, BatteryState</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from geometry_msgs.msg import Twist, PoseWithCovarianceStamped</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from nav_msgs.msg import Odometry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from std_msgs.msg import String, Bool, Float32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from builtin_interfaces.msg import Time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import threading</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from collections import deque, defaultdict</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from typing import Dict, Any, Optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class CommunicationProtocolHandler(Node):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def __init__(self):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        super().__init__(&#x27;communication_protocol_handler&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Protocol configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.protocol_config = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;heartbeat_interval&#x27;: 1.0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;message_timeout&#x27;: 5.0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;retry_limit&#x27;: 3,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;priority_levels&#x27;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &#x27;high&#x27;: 100,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &#x27;normal&#x27;: 50,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &#x27;low&#x27;: 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Message queues for different priority levels</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.message_queues = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;high&#x27;: deque(maxlen=50),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;normal&#x27;: deque(maxlen=100),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;low&#x27;: deque(maxlen=200)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Message statistics tracking</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.message_stats = defaultdict(lambda: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;sent&#x27;: 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;received&#x27;: 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;errors&#x27;: 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;latency_history&#x27;: deque(maxlen=100),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;bandwidth_history&#x27;: deque(maxlen=100)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Communication state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.connection_status = True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.heartbeat_timestamp = None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.sequence_numbers = defaultdict(int)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # QoS profiles for different message types</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.qos_profiles = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;sensor_data&#x27;: QoSProfile(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                reliability=ReliabilityPolicy.RELIABLE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                durability=DurabilityPolicy.VOLATILE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                history=HistoryPolicy.KEEP_LAST,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                depth=10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;control_commands&#x27;: QoSProfile(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                reliability=ReliabilityPolicy.RELIABLE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                durability=DurabilityPolicy.TRANSIENT_LOCAL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                history=HistoryPolicy.KEEP_LAST,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                depth=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;status_updates&#x27;: QoSProfile(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                reliability=ReliabilityPolicy.BEST_EFFORT,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                durability=DurabilityPolicy.VOLATILE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                history=HistoryPolicy.KEEP_LAST,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                depth=5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Subscribers for incoming messages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.camera_subscription = self.create_subscription(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Image,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;/camera/color/image_raw&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.handle_camera_message,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.qos_profiles[&#x27;sensor_data&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.lidar_subscription = self.create_subscription(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            LaserScan,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;/scan&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.handle_lidar_message,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.qos_profiles[&#x27;sensor_data&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.imu_subscription = self.create_subscription(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Imu,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;/imu&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.handle_imu_message,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.qos_profiles[&#x27;sensor_data&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.odom_subscription = self.create_subscription(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Odometry,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;/odom&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.handle_odom_message,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.qos_profiles[&#x27;status_updates&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Publishers for outgoing messages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.cmd_vel_publisher = self.create_publisher(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Twist,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;/cmd_vel&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.qos_profiles[&#x27;control_commands&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.status_publisher = self.create_publisher(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;/communication/status&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.qos_profiles[&#x27;status_updates&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.heartbeat_publisher = self.create_publisher(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Time,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;/communication/heartbeat&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.qos_profiles[&#x27;status_updates&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Timers for protocol management</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.heartbeat_timer = self.create_timer(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.protocol_config[&#x27;heartbeat_interval&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.send_heartbeat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.stats_timer = self.create_timer(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            2.0,  # Update stats every 2 seconds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.publish_statistics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Start protocol handler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.protocol_thread = threading.Thread(target=self.process_messages)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.protocol_thread.daemon = True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.protocol_thread.start()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.get_logger().info(&#x27;Communication Protocol Handler initialized&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def handle_camera_message(self, msg):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Handle incoming camera messages&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.track_message(&#x27;camera&#x27;, &#x27;received&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Process camera message with protocol handling</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        processed_msg = self.apply_protocol_rules(msg, &#x27;camera&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Add to appropriate queue based on priority</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.enqueue_message(processed_msg, &#x27;normal&#x27;, &#x27;camera&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def handle_lidar_message(self, msg):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Handle incoming LiDAR messages&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.track_message(&#x27;lidar&#x27;, &#x27;received&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Process LiDAR message with protocol handling</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        processed_msg = self.apply_protocol_rules(msg, &#x27;lidar&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Add to appropriate queue based on priority</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.enqueue_message(processed_msg, &#x27;high&#x27;, &#x27;lidar&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def handle_imu_message(self, msg):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Handle incoming IMU messages&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.track_message(&#x27;imu&#x27;, &#x27;received&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Process IMU message with protocol handling</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        processed_msg = self.apply_protocol_rules(msg, &#x27;imu&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Add to appropriate queue based on priority</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.enqueue_message(processed_msg, &#x27;high&#x27;, &#x27;imu&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def handle_odom_message(self, msg):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Handle incoming odometry messages&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.track_message(&#x27;odometry&#x27;, &#x27;received&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Process odometry message with protocol handling</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        processed_msg = self.apply_protocol_rules(msg, &#x27;odometry&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Add to appropriate queue based on priority</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.enqueue_message(processed_msg, &#x27;normal&#x27;, &#x27;odometry&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def apply_protocol_rules(self, msg, msg_type):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Apply communication protocol rules to messages&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Add sequence number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        seq_num = self.sequence_numbers[msg_type]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.sequence_numbers[msg_type] += 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Add timestamp if not present</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if not hasattr(msg.header, &#x27;stamp&#x27;) or msg.header.stamp.sec == 0:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            msg.header.stamp = self.get_clock().now().to_msg()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Apply message validation rules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        validated_msg = self.validate_message(msg, msg_type)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return validated_msg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def validate_message(self, msg, msg_type):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Validate message according to protocol&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Basic validation - in practice, this would be more extensive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if msg_type == &#x27;lidar&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # Validate LiDAR ranges</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if hasattr(msg, &#x27;ranges&#x27;) and msg.ranges:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                valid_ranges = [r for r in msg.ranges if msg.range_min &lt;= r &lt;= msg.range_max]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if len(valid_ranges) != len(msg.ranges):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    self.get_logger().warn(f&#x27;Invalid LiDAR ranges detected in message&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return msg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def enqueue_message(self, msg, priority, msg_type):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Add message to appropriate priority queue&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        queue_item = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;message&#x27;: msg,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;priority&#x27;: priority,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;type&#x27;: msg_type,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;timestamp&#x27;: time.time(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;sequence&#x27;: self.sequence_numbers[msg_type]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.message_queues[priority].append(queue_item)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def send_heartbeat(self):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Send periodic heartbeat to maintain connection&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            heartbeat_msg = Time()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            heartbeat_msg.sec = int(time.time())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            heartbeat_msg.nanosec = int((time.time() % 1) * 1e9)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.heartbeat_publisher.publish(heartbeat_msg)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.heartbeat_timestamp = time.time()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.get_logger().debug(f&#x27;Sent heartbeat at {heartbeat_msg.sec}.{heartbeat_msg.nanosec}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        except Exception as e:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.get_logger().error(f&#x27;Error sending heartbeat: {e}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def process_messages(self):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Process messages in priority order&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        while rclpy.ok():</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            try:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                # Process high priority messages first</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                self.process_queue(&#x27;high&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                self.process_queue(&#x27;normal&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                self.process_queue(&#x27;low&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                # Small delay to prevent busy waiting</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                time.sleep(0.001)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            except Exception as e:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                self.get_logger().error(f&#x27;Error processing messages: {e}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def process_queue(self, priority):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Process messages in a specific priority queue&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        while len(self.message_queues[priority]) &gt; 0:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            try:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                queue_item = self.message_queues[priority].popleft()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                # Process the message based on its type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                self.process_specific_message(queue_item)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            except IndexError:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                # Queue is empty</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                break</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            except Exception as e:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                self.get_logger().error(f&#x27;Error processing queue {priority}: {e}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def process_specific_message(self, queue_item):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Process a specific message based on its type&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        msg = queue_item[&#x27;message&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        msg_type = queue_item[&#x27;type&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Handle different message types</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if msg_type.startswith(&#x27;camera&#x27;):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # Process camera data (e.g., send to perception system)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.process_camera_data(msg)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        elif msg_type.startswith(&#x27;lidar&#x27;):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # Process LiDAR data (e.g., send to navigation system)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.process_lidar_data(msg)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        elif msg_type.startswith(&#x27;imu&#x27;):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # Process IMU data (e.g., send to state estimator)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.process_imu_data(msg)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        elif msg_type.startswith(&#x27;odometry&#x27;):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # Process odometry data (e.g., send to localization system)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.process_odom_data(msg)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def process_camera_data(self, msg):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Process camera data and send to perception system&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # In a real implementation, this would send to perception system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # For simulation, just log the processing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.get_logger().debug(f&#x27;Processing camera data: {msg.width}x{msg.height}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def process_lidar_data(self, msg):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Process LiDAR data and send to navigation system&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # In a real implementation, this would send to navigation system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.get_logger().debug(f&#x27;Processing LiDAR data: {len(msg.ranges)} ranges&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def process_imu_data(self, msg):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Process IMU data and send to state estimator&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # In a real implementation, this would send to state estimation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.get_logger().debug(f&#x27;Processing IMU data: {msg.linear_acceleration}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def process_odom_data(self, msg):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Process odometry data and send to localization system&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # In a real implementation, this would send to localization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.get_logger().debug(f&#x27;Processing odometry data: {msg.pose.pose.position}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def send_command(self, command_msg, priority=&#x27;normal&#x27;):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Send a command with specified priority&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # Add protocol headers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            command_msg.header.stamp = self.get_clock().now().to_msg()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # Track sent message</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.track_message(&#x27;command&#x27;, &#x27;sent&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # Publish command</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.cmd_vel_publisher.publish(command_msg)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.get_logger().debug(f&#x27;Sent command with priority: {priority}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        except Exception as e:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.get_logger().error(f&#x27;Error sending command: {e}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.track_message(&#x27;command&#x27;, &#x27;error&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def track_message(self, msg_type, event):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Track message statistics&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if event == &#x27;sent&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.message_stats[msg_type][&#x27;sent&#x27;] += 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        elif event == &#x27;received&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.message_stats[msg_type][&#x27;received&#x27;] += 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        elif event == &#x27;error&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.message_stats[msg_type][&#x27;errors&#x27;] += 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def publish_statistics(self):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Publish communication statistics&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # Calculate statistics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            stats_msg = String()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            stats_data = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &#x27;connection_status&#x27;: self.connection_status,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &#x27;messages_sent&#x27;: sum(stat[&#x27;sent&#x27;] for stat in self.message_stats.values()),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &#x27;messages_received&#x27;: sum(stat[&#x27;received&#x27;] for stat in self.message_stats.values()),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &#x27;errors&#x27;: sum(stat[&#x27;errors&#x27;] for stat in self.message_stats.values()),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &#x27;queues&#x27;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &#x27;high&#x27;: len(self.message_queues[&#x27;high&#x27;]),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &#x27;normal&#x27;: len(self.message_queues[&#x27;normal&#x27;]),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &#x27;low&#x27;: len(self.message_queues[&#x27;low&#x27;])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            stats_msg.data = json.dumps(stats_data)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.status_publisher.publish(stats_msg)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        except Exception as e:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.get_logger().error(f&#x27;Error publishing statistics: {e}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def get_communication_summary(self):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Get communication performance summary&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;connection_status&#x27;: self.connection_status,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;message_stats&#x27;: dict(self.message_stats),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;queue_sizes&#x27;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &#x27;high&#x27;: len(self.message_queues[&#x27;high&#x27;]),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &#x27;normal&#x27;: len(self.message_queues[&#x27;normal&#x27;]),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &#x27;low&#x27;: len(self.message_queues[&#x27;low&#x27;])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;sequence_numbers&#x27;: dict(self.sequence_numbers),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;heartbeat_timestamp&#x27;: self.heartbeat_timestamp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def main(args=None):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rclpy.init(args=args)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protocol_handler = CommunicationProtocolHandler()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rclpy.spin(protocol_handler)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    except KeyboardInterrupt:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        summary = protocol_handler.get_communication_summary()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        print(f&quot;Communication Summary: {summary}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    finally:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        protocol_handler.destroy_node()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rclpy.shutdown()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if __name__ == &#x27;__main__&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    main()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="message-serialization-and-compression">Message Serialization and Compression<a href="#message-serialization-and-compression" class="hash-link" aria-label="Direct link to Message Serialization and Compression" title="Direct link to Message Serialization and Compression" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-creating-message-serialization-utilities">1. Creating Message Serialization Utilities<a href="#1-creating-message-serialization-utilities" class="hash-link" aria-label="Direct link to 1. Creating Message Serialization Utilities" title="Direct link to 1. Creating Message Serialization Utilities" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat &gt; ~/isaac_ros_ws/src/isaac_communication_protocol/communication_protocol/message_serializer.py &lt;&lt; &#x27;EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#!/usr/bin/env python3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import rclpy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from rclpy.node import Node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from sensor_msgs.msg import Image, LaserScan, Imu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from geometry_msgs.msg import Twist</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from std_msgs.msg import String</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import numpy as np</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import cv2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import pickle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import gzip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from typing import Any, Dict</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import struct</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class MessageSerializer:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def __init__(self):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.compression_level = 6  # Default compression level</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def serialize_image(self, image_msg) -&gt; bytes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Serialize Image message with optional compression&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Convert ROS Image to numpy array</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if image_msg.encoding == &#x27;rgb8&#x27; or image_msg.encoding == &#x27;bgr8&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            dtype = np.uint8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        elif image_msg.encoding == &#x27;rgba8&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            dtype = np.uint8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        elif image_msg.encoding == &#x27;mono8&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            dtype = np.uint8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            raise ValueError(f&quot;Unsupported image encoding: {image_msg.encoding}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Reshape image data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        height, width = image_msg.height, image_msg.width</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        channels = 1 if &#x27;mono&#x27; in image_msg.encoding else 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        image_array = np.frombuffer(image_msg.data, dtype=dtype).reshape((height, width, channels))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Serialize image metadata</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        metadata = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;width&#x27;: width,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;height&#x27;: height,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;encoding&#x27;: image_msg.encoding,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;step&#x27;: image_msg.step,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;header&#x27;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &#x27;stamp&#x27;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &#x27;sec&#x27;: image_msg.header.stamp.sec,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &#x27;nanosec&#x27;: image_msg.header.stamp.nanosec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &#x27;frame_id&#x27;: image_msg.header.frame_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Pack image and metadata</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        packed_data = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;metadata&#x27;: metadata,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;image_data&#x27;: image_array</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Serialize to bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        serialized = pickle.dumps(packed_data)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Compress if requested</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        compressed = gzip.compress(serialized, compresslevel=self.compression_level)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return compressed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def deserialize_image(self, serialized_data: bytes) -&gt; object:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Deserialize Image message from compressed bytes&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Decompress data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        decompressed = gzip.decompress(serialized_data)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Deserialize</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        packed_data = pickle.loads(decompressed)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Extract metadata and image data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        metadata = packed_data[&#x27;metadata&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        image_data = packed_data[&#x27;image_data&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Convert back to ROS Image message</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        from sensor_msgs.msg import Image</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        image_msg = Image()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        image_msg.width = metadata[&#x27;width&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        image_msg.height = metadata[&#x27;height&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        image_msg.encoding = metadata[&#x27;encoding&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        image_msg.step = metadata[&#x27;step&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        image_msg.header.stamp.sec = metadata[&#x27;header&#x27;][&#x27;stamp&#x27;][&#x27;sec&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        image_msg.header.stamp.nanosec = metadata[&#x27;header&#x27;][&#x27;stamp&#x27;][&#x27;nanosec&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        image_msg.header.frame_id = metadata[&#x27;header&#x27;][&#x27;frame_id&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Convert image data back to bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        image_bytes = image_data.tobytes()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        image_msg.data = image_bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return image_msg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def serialize_laserscan(self, scan_msg) -&gt; bytes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Serialize LaserScan message with optional compression&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Create dictionary with scan data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        scan_data = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;header&#x27;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &#x27;stamp&#x27;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &#x27;sec&#x27;: scan_msg.header.stamp.sec,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &#x27;nanosec&#x27;: scan_msg.header.stamp.nanosec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &#x27;frame_id&#x27;: scan_msg.header.frame_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;angle_min&#x27;: scan_msg.angle_min,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;angle_max&#x27;: scan_msg.angle_max,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;angle_increment&#x27;: scan_msg.angle_increment,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;time_increment&#x27;: scan_msg.time_increment,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;scan_time&#x27;: scan_msg.scan_time,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;range_min&#x27;: scan_msg.range_min,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;range_max&#x27;: scan_msg.range_max,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;ranges&#x27;: np.array(scan_msg.ranges, dtype=np.float32),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;intensities&#x27;: np.array(scan_msg.intensities, dtype=np.float32) if scan_msg.intensities else []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Serialize to bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        serialized = pickle.dumps(scan_data)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Compress if requested</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        compressed = gzip.compress(serialized, compresslevel=self.compression_level)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return compressed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def deserialize_laserscan(self, serialized_data: bytes) -&gt; object:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Deserialize LaserScan message from compressed bytes&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Decompress data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        decompressed = gzip.decompress(serialized_data)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Deserialize</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        scan_data = pickle.loads(decompressed)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Convert back to ROS LaserScan message</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        from sensor_msgs.msg import LaserScan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        scan_msg = LaserScan()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        scan_msg.header.stamp.sec = scan_data[&#x27;header&#x27;][&#x27;stamp&#x27;][&#x27;sec&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        scan_msg.header.stamp.nanosec = scan_data[&#x27;header&#x27;][&#x27;stamp&#x27;][&#x27;nanosec&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        scan_msg.header.frame_id = scan_data[&#x27;header&#x27;][&#x27;frame_id&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        scan_msg.angle_min = scan_data[&#x27;angle_min&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        scan_msg.angle_max = scan_data[&#x27;angle_max&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        scan_msg.angle_increment = scan_data[&#x27;angle_increment&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        scan_msg.time_increment = scan_data[&#x27;time_increment&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        scan_msg.scan_time = scan_data[&#x27;scan_time&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        scan_msg.range_min = scan_data[&#x27;range_min&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        scan_msg.range_max = scan_data[&#x27;range_max&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        scan_msg.ranges = scan_data[&#x27;ranges&#x27;].tolist()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        scan_msg.intensities = scan_data[&#x27;intensities&#x27;].tolist() if scan_data[&#x27;intensities&#x27;] else []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return scan_msg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def serialize_twist(self, twist_msg) -&gt; bytes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Serialize Twist message&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        twist_data = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;linear&#x27;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &#x27;x&#x27;: twist_msg.linear.x,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &#x27;y&#x27;: twist_msg.linear.y,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &#x27;z&#x27;: twist_msg.linear.z</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;angular&#x27;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &#x27;x&#x27;: twist_msg.angular.x,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &#x27;y&#x27;: twist_msg.angular.y,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &#x27;z&#x27;: twist_msg.angular.z</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return json.dumps(twist_data).encode(&#x27;utf-8&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def deserialize_twist(self, serialized_data: bytes) -&gt; object:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Deserialize Twist message&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        from geometry_msgs.msg import Twist</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        twist_data = json.loads(serialized_data.decode(&#x27;utf-8&#x27;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        twist_msg = Twist()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        twist_msg.linear.x = twist_data[&#x27;linear&#x27;][&#x27;x&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        twist_msg.linear.y = twist_data[&#x27;linear&#x27;][&#x27;y&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        twist_msg.linear.z = twist_data[&#x27;linear&#x27;][&#x27;z&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        twist_msg.angular.x = twist_data[&#x27;angular&#x27;][&#x27;x&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        twist_msg.angular.y = twist_data[&#x27;angular&#x27;][&#x27;y&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        twist_msg.angular.z = twist_data[&#x27;angular&#x27;][&#x27;z&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return twist_msg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def calculate_compression_ratio(self, original_size: int, compressed_size: int) -&gt; float:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Calculate compression ratio&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if original_size == 0:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (original_size - compressed_size) / original_size * 100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class MessageCompressionNode(Node):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def __init__(self):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        super().__init__(&#x27;message_compression_node&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Initialize serializer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.serializer = MessageSerializer()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Publishers and subscribers for testing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.compressed_image_publisher = self.create_publisher(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String,  # Using String to send compressed data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;/compressed/image&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.compressed_scan_publisher = self.create_publisher(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String,  # Using String to send compressed data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;/compressed/scan&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Subscribers for original data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.original_image_subscription = self.create_subscription(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Image,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;/camera/color/image_raw&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.image_compress_callback,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.original_scan_subscription = self.create_subscription(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            LaserScan,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;/scan&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.scan_compress_callback,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.get_logger().info(&#x27;Message Compression Node initialized&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def image_compress_callback(self, msg):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Compress and publish image message&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # Serialize and compress image</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            compressed_data = self.serializer.serialize_image(msg)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # Calculate compression statistics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            original_size = len(msg.data)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            compressed_size = len(compressed_data)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ratio = self.serializer.calculate_compression_ratio(original_size, compressed_size)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.get_logger().debug(f&#x27;Image compression: {ratio:.2f}% reduction&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # Publish compressed data as string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            compressed_msg = String()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            compressed_msg.data = compressed_data.hex()  # Convert to hex for transmission</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.compressed_image_publisher.publish(compressed_msg)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        except Exception as e:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.get_logger().error(f&#x27;Error compressing image: {e}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def scan_compress_callback(self, msg):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Compress and publish scan message&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # Serialize and compress scan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            compressed_data = self.serializer.serialize_laserscan(msg)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # Calculate compression statistics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            original_size = len(pickle.dumps(msg))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            compressed_size = len(compressed_data)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ratio = self.serializer.calculate_compression_ratio(original_size, compressed_size)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.get_logger().debug(f&#x27;Scan compression: {ratio:.2f}% reduction&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # Publish compressed data as string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            compressed_msg = String()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            compressed_msg.data = compressed_data.hex()  # Convert to hex for transmission</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.compressed_scan_publisher.publish(compressed_msg)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        except Exception as e:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.get_logger().error(f&#x27;Error compressing scan: {e}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def main(args=None):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rclpy.init(args=args)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compression_node = MessageCompressionNode()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rclpy.spin(compression_node)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    except KeyboardInterrupt:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    finally:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        compression_node.destroy_node()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rclpy.shutdown()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if __name__ == &#x27;__main__&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    main()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="communication-middleware-integration">Communication Middleware Integration<a href="#communication-middleware-integration" class="hash-link" aria-label="Direct link to Communication Middleware Integration" title="Direct link to Communication Middleware Integration" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-creating-communication-middleware">1. Creating Communication Middleware<a href="#1-creating-communication-middleware" class="hash-link" aria-label="Direct link to 1. Creating Communication Middleware" title="Direct link to 1. Creating Communication Middleware" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat &gt; ~/isaac_ros_ws/src/isaac_communication_protocol/communication_protocol/middleware.py &lt;&lt; &#x27;EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#!/usr/bin/env python3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import rclpy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from rclpy.node import Node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from std_msgs.msg import String, Bool, Float32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from sensor_msgs.msg import Image, LaserScan, Imu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from geometry_msgs.msg import Twist</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from builtin_interfaces.msg import Time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import threading</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import queue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from typing import Dict, Any, Callable, Optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from collections import defaultdict</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class CommunicationMiddleware(Node):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def __init__(self):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        super().__init__(&#x27;communication_middleware&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Middleware configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.middleware_config = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;max_queue_size&#x27;: 1000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;processing_threads&#x27;: 4,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;message_timeout&#x27;: 5.0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;retry_attempts&#x27;: 3,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;retry_delay&#x27;: 0.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Message queues for different types</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.input_queues = defaultdict(queue.Queue)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.output_queues = defaultdict(queue.Queue)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Message handlers registry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.message_handlers = {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.topic_subscriptions = {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Statistics tracking</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.stats = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;messages_processed&#x27;: 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;messages_dropped&#x27;: 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;average_latency&#x27;: 0.0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;throughput&#x27;: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Processing threads</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.processing_threads = []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.running = True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Start processing threads</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for i in range(self.middleware_config[&#x27;processing_threads&#x27;]):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            thread = threading.Thread(target=self.process_messages, args=(i,))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            thread.daemon = True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            thread.start()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.processing_threads.append(thread)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Publishers for statistics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.stats_publisher = self.create_publisher(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;/middleware/stats&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Timer for publishing statistics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.stats_timer = self.create_timer(1.0, self.publish_stats)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.get_logger().info(&#x27;Communication Middleware initialized&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def register_handler(self, topic_type: str, handler_func: Callable):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Register a message handler for a specific topic type&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.message_handlers[topic_type] = handler_func</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.get_logger().info(f&#x27;Registered handler for {topic_type}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def subscribe(self, topic: str, msg_type, callback: Callable, qos_profile=None):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Subscribe to a topic through middleware&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if qos_profile is None:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            from rclpy.qos import QoSProfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            qos_profile = QoSProfile(depth=10)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        subscription = self.create_subscription(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            msg_type,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            topic,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            lambda msg: self.enqueue_message(topic, msg),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            qos_profile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.topic_subscriptions[topic] = subscription</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return subscription</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def enqueue_message(self, topic: str, msg):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Enqueue a message for processing&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            message_wrapper = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &#x27;topic&#x27;: topic,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &#x27;message&#x27;: msg,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &#x27;timestamp&#x27;: time.time(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &#x27;sequence_id&#x27;: self.generate_sequence_id()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # Add to input queue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if self.input_queues[topic].qsize() &lt; self.middleware_config[&#x27;max_queue_size&#x27;]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                self.input_queues[topic].put(message_wrapper)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                self.stats[&#x27;messages_processed&#x27;] += 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            else:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                self.stats[&#x27;messages_dropped&#x27;] += 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                self.get_logger().warn(f&#x27;Message queue full for topic {topic}, dropping message&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        except Exception as e:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.get_logger().error(f&#x27;Error enqueuing message: {e}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def process_messages(self, thread_id: int):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Process messages in a dedicated thread&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        while self.running:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            try:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                # Process messages from all queues</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                for topic, q in self.input_queues.items():</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    try:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        if not q.empty():</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            message_wrapper = q.get_nowait()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            # Process the message</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            self.process_message(message_wrapper)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    except queue.Empty:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        # No messages in this queue, continue to next</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        continue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    except Exception as e:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        self.get_logger().error(f&#x27;Error processing message in thread {thread_id}: {e}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                # Small delay to prevent busy waiting</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                time.sleep(0.001)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            except Exception as e:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                self.get_logger().error(f&#x27;Error in processing thread {thread_id}: {e}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def process_message(self, message_wrapper: Dict):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Process a single message&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        topic = message_wrapper[&#x27;topic&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        msg = message_wrapper[&#x27;message&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        timestamp = message_wrapper[&#x27;timestamp&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Determine message type and call appropriate handler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        msg_type = type(msg).__name__.lower()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if msg_type in self.message_handlers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            try:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                # Call the registered handler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                result = self.message_handlers[msg_type](msg, topic)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                # Calculate latency</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                latency = time.time() - timestamp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                self.update_latency_stats(latency)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                # Log processing result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                self.get_logger().debug(f&#x27;Processed {msg_type} message on {topic}, latency: {latency:.4f}s&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            except Exception as e:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                self.get_logger().error(f&#x27;Error in message handler for {msg_type}: {e}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.get_logger().warn(f&#x27;No handler registered for message type: {msg_type}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def generate_sequence_id(self) -&gt; int:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Generate a sequence ID for message ordering&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if not hasattr(self, &#x27;_sequence_counter&#x27;):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self._sequence_counter = 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self._sequence_counter += 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return self._sequence_counter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def update_latency_stats(self, latency: float):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Update latency statistics&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.stats[&#x27;average_latency&#x27;] = (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.stats[&#x27;average_latency&#x27;] * 0.9 + latency * 0.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )  # Exponential moving average</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def publish_stats(self):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Publish middleware statistics&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            stats_msg = String()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            stats_msg.data = json.dumps(self.stats)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.stats_publisher.publish(stats_msg)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.get_logger().debug(f&#x27;Middleware stats: {self.stats}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        except Exception as e:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.get_logger().error(f&#x27;Error publishing stats: {e}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def add_topic_filter(self, topic: str, filter_func: Callable):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Add a filter function for a specific topic&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # In a real implementation, this would apply filters before processing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def get_middleware_status(self) -&gt; Dict:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Get middleware operational status&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        queue_sizes = {topic: q.qsize() for topic, q in self.input_queues.items()}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;stats&#x27;: self.stats,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;queue_sizes&#x27;: queue_sizes,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;handlers_registered&#x27;: list(self.message_handlers.keys()),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;subscriptions_active&#x27;: len(self.topic_subscriptions),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;threads_running&#x27;: len(self.processing_threads)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def shutdown(self):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Gracefully shut down middleware&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.running = False</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Wait for threads to finish</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for thread in self.processing_threads:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            thread.join(timeout=1.0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def main(args=None):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rclpy.init(args=args)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    middleware = CommunicationMiddleware()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rclpy.spin(middleware)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    except KeyboardInterrupt:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        status = middleware.get_middleware_status()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        print(f&quot;Middleware Status: {status}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        middleware.shutdown()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    finally:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        middleware.destroy_node()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rclpy.shutdown()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if __name__ == &#x27;__main__&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    main()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="communication-protocol-launch-files">Communication Protocol Launch Files<a href="#communication-protocol-launch-files" class="hash-link" aria-label="Direct link to Communication Protocol Launch Files" title="Direct link to Communication Protocol Launch Files" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-creating-communication-protocol-package">1. Creating Communication Protocol Package<a href="#1-creating-communication-protocol-package" class="hash-link" aria-label="Direct link to 1. Creating Communication Protocol Package" title="Direct link to 1. Creating Communication Protocol Package" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd ~/isaac_ros_ws/src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source /opt/ros/humble/setup.bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Create communication protocol package</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ros2 pkg create --build-type ament_python isaac_communication_protocol --dependencies rclpy sensor_msgs geometry_msgs std_msgs message_filters tf2_ros tf2_geometry_msgs nav_msgs vision_msgs builtin_interfaces</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-creating-setup-files-for-communication-package">2. Creating Setup Files for Communication Package<a href="#2-creating-setup-files-for-communication-package" class="hash-link" aria-label="Direct link to 2. Creating Setup Files for Communication Package" title="Direct link to 2. Creating Setup Files for Communication Package" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat &gt; ~/isaac_ros_ws/src/isaac_communication_protocol/setup.py &lt;&lt; &#x27;EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from setuptools import setup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from glob import glob</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">package_name = &#x27;isaac_communication_protocol&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">setup(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name=package_name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    version=&#x27;0.0.1&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    packages=[package_name],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data_files=[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        (&#x27;share/ament_index/resource_index/packages&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            [&#x27;resource/&#x27; + package_name]),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        (&#x27;share/&#x27; + package_name, [&#x27;package.xml&#x27;]),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Include launch files</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        (os.path.join(&#x27;share&#x27;, package_name, &#x27;launch&#x27;), glob(&#x27;launch/*.py&#x27;)),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    install_requires=[&#x27;setuptools&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    zip_safe=True,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    maintainer=&#x27;Your Name&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    maintainer_email=&#x27;your.email@example.com&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    description=&#x27;Communication protocols for Isaac Sim AI-Robot systems&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    license=&#x27;Apache License 2.0&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tests_require=[&#x27;pytest&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    entry_points={</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;console_scripts&#x27;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;protocol_handler = isaac_communication_protocol.protocol_handler:main&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;message_compression = isaac_communication_protocol.message_serializer:main&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;communication_middleware = isaac_communication_protocol.middleware:main&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat &gt; ~/isaac_ros_ws/src/isaac_communication_protocol/package.xml &lt;&lt; &#x27;EOF&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;?xml-model href=&quot;http://download.ros.org/schema/package_format3.xsd&quot; schematypens=&quot;http://www.w3.org/2001/XMLSchema&quot;?&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;package format=&quot;3&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;name&gt;isaac_communication_protocol&lt;/name&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;version&gt;0.0.1&lt;/version&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;description&gt;Communication protocols for Isaac Sim AI-Robot systems&lt;/description&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;maintainer email=&quot;your.email@example.com&quot;&gt;Your Name&lt;/maintainer&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;license&gt;Apache License 2.0&lt;/license&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;depend&gt;rclpy&lt;/depend&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;depend&gt;sensor_msgs&lt;/depend&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;depend&gt;geometry_msgs&lt;/depend&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;depend&gt;std_msgs&lt;/depend&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;depend&gt;message_filters&lt;/depend&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;depend&gt;tf2_ros&lt;/depend&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;depend&gt;tf2_geometry_msgs&lt;/depend&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;depend&gt;nav_msgs&lt;/depend&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;depend&gt;vision_msgs&lt;/depend&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;depend&gt;builtin_interfaces&lt;/depend&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;test_depend&gt;ament_copyright&lt;/test_depend&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;test_depend&gt;ament_flake8&lt;/test_depend&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;test_depend&gt;ament_pep257&lt;/test_depend&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;test_depend&gt;python3-pytest&lt;/test_depend&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;export&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;build_type&gt;ament_python&lt;/build_type&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;/export&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/package&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="3-creating-communication-protocol-launch-file">3. Creating Communication Protocol Launch File<a href="#3-creating-communication-protocol-launch-file" class="hash-link" aria-label="Direct link to 3. Creating Communication Protocol Launch File" title="Direct link to 3. Creating Communication Protocol Launch File" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p ~/isaac_ros_ws/src/isaac_communication_protocol/launch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat &gt; ~/isaac_ros_ws/src/isaac_communication_protocol/launch/communication_protocol.launch.py &lt;&lt; &#x27;EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from launch import LaunchDescription</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from launch.actions import DeclareLaunchArgument, TimerAction</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from launch.substitutions import LaunchConfiguration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from launch_ros.actions import Node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from ament_index_python.packages import get_package_share_directory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def generate_launch_description():</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Launch arguments</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use_sim_time = LaunchConfiguration(&#x27;use_sim_time&#x27;, default=&#x27;true&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enable_compression = LaunchConfiguration(&#x27;enable_compression&#x27;, default=&#x27;true&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enable_middleware = LaunchConfiguration(&#x27;enable_middleware&#x27;, default=&#x27;true&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Communication protocol handler node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protocol_handler = Node(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        package=&#x27;isaac_communication_protocol&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        executable=&#x27;protocol_handler&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name=&#x27;communication_protocol_handler&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        parameters=[{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;use_sim_time&#x27;: use_sim_time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        output=&#x27;screen&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Message compression node (optional)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    message_compression = Node(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        package=&#x27;isaac_communication_protocol&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        executable=&#x27;message_compression&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name=&#x27;message_compression_node&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        parameters=[{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;use_sim_time&#x27;: use_sim_time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        output=&#x27;screen&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        condition=lambda context: LaunchConfiguration(&#x27;enable_compression&#x27;).perform(context) == &#x27;true&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Communication middleware node (optional)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    communication_middleware = Node(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        package=&#x27;isaac_communication_protocol&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        executable=&#x27;communication_middleware&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name=&#x27;communication_middleware&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        parameters=[{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;use_sim_time&#x27;: use_sim_time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        output=&#x27;screen&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        condition=lambda context: LaunchConfiguration(&#x27;enable_middleware&#x27;).perform(context) == &#x27;true&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Return launch description</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ld = LaunchDescription()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Add launch arguments</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ld.add_action(DeclareLaunchArgument(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;use_sim_time&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        default_value=&#x27;true&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        description=&#x27;Use simulation (Isaac Sim) clock if true&#x27;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ld.add_action(DeclareLaunchArgument(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;enable_compression&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        default_value=&#x27;true&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        description=&#x27;Enable message compression&#x27;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ld.add_action(DeclareLaunchArgument(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;enable_middleware&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        default_value=&#x27;true&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        description=&#x27;Enable communication middleware&#x27;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Add nodes with timing delays for proper initialization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ld.add_action(protocol_handler)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ld.add_action(TimerAction(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        period=1.0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        actions=[message_compression]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ld.add_action(TimerAction(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        period=2.0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        actions=[communication_middleware]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return ld</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="communication-performance-optimization">Communication Performance Optimization<a href="#communication-performance-optimization" class="hash-link" aria-label="Direct link to Communication Performance Optimization" title="Direct link to Communication Performance Optimization" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-creating-performance-optimization-tools">1. Creating Performance Optimization Tools<a href="#1-creating-performance-optimization-tools" class="hash-link" aria-label="Direct link to 1. Creating Performance Optimization Tools" title="Direct link to 1. Creating Performance Optimization Tools" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat &gt; ~/isaac_sim_shared/scripts/communication_optimizer.py &lt;&lt; &#x27;EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#!/usr/bin/env python3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import rclpy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from rclpy.node import Node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from std_msgs.msg import String, Float32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from sensor_msgs.msg import Image, LaserScan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from geometry_msgs.msg import Twist</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import threading</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from collections import deque, defaultdict</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from typing import Dict, List</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class CommunicationOptimizer(Node):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def __init__(self):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        super().__init__(&#x27;communication_optimizer&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Performance tracking</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.performance_metrics = defaultdict(lambda: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;bandwidth_usage&#x27;: deque(maxlen=100),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;latency_history&#x27;: deque(maxlen=100),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;message_frequency&#x27;: deque(maxlen=100),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;compression_ratio&#x27;: deque(maxlen=100)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Optimization parameters</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.optimization_params = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;target_bandwidth&#x27;: 100.0,  # Mbps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;max_latency&#x27;: 0.1,         # seconds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;min_compression_ratio&#x27;: 0.1,  # 10% reduction</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;adaptive_frequency&#x27;: True,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;adaptive_compression&#x27;: True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Subscribers for performance monitoring</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.bandwidth_subscriber = self.create_subscription(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Float32,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;/communication/bandwidth_usage&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.bandwidth_callback,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.latency_subscriber = self.create_subscription(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Float32,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;/communication/latency&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.latency_callback,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.compression_subscriber = self.create_subscription(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Float32,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;/communication/compression_ratio&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.compression_callback,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Publishers for optimization commands</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.frequency_publisher = self.create_publisher(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;/communication/frequency_control&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.compression_publisher = self.create_publisher(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;/communication/compression_control&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.optimization_status_publisher = self.create_publisher(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;/communication/optimization_status&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Timer for periodic optimization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.optimization_timer = self.create_timer(2.0, self.optimize_communication)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.get_logger().info(&#x27;Communication Optimizer initialized&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def bandwidth_callback(self, msg):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Track bandwidth usage&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.performance_metrics[&#x27;bandwidth_usage&#x27;].append(msg.data)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def latency_callback(self, msg):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Track latency&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.performance_metrics[&#x27;latency_history&#x27;].append(msg.data)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def compression_callback(self, msg):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Track compression ratio&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.performance_metrics[&#x27;compression_ratio&#x27;].append(msg.data)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def optimize_communication(self):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Perform communication optimization&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # Calculate current performance metrics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            current_metrics = self.calculate_current_metrics()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # Determine optimization actions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            optimization_actions = self.determine_optimizations(current_metrics)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # Apply optimizations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.apply_optimizations(optimization_actions)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # Publish optimization status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            status_msg = String()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            status_msg.data = json.dumps({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &#x27;timestamp&#x27;: time.time(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &#x27;current_metrics&#x27;: current_metrics,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &#x27;optimization_actions&#x27;: optimization_actions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.optimization_status_publisher.publish(status_msg)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.get_logger().info(f&#x27;Applied optimizations: {optimization_actions}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        except Exception as e:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.get_logger().error(f&#x27;Error in communication optimization: {e}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def calculate_current_metrics(self) -&gt; Dict:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Calculate current communication metrics&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        metrics = {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Bandwidth usage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if self.performance_metrics[&#x27;bandwidth_usage&#x27;]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            metrics[&#x27;avg_bandwidth&#x27;] = sum(self.performance_metrics[&#x27;bandwidth_usage&#x27;]) / len(self.performance_metrics[&#x27;bandwidth_usage&#x27;])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            metrics[&#x27;avg_bandwidth&#x27;] = 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Latency</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if self.performance_metrics[&#x27;latency_history&#x27;]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            metrics[&#x27;avg_latency&#x27;] = sum(self.performance_metrics[&#x27;latency_history&#x27;]) / len(self.performance_metrics[&#x27;latency_history&#x27;])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            metrics[&#x27;avg_latency&#x27;] = 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Compression ratio</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if self.performance_metrics[&#x27;compression_ratio&#x27;]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            metrics[&#x27;avg_compression&#x27;] = sum(self.performance_metrics[&#x27;compression_ratio&#x27;]) / len(self.performance_metrics[&#x27;compression_ratio&#x27;])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            metrics[&#x27;avg_compression&#x27;] = 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return metrics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def determine_optimizations(self, current_metrics: Dict) -&gt; Dict:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Determine optimization actions based on current metrics&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        actions = {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Bandwidth optimization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if current_metrics[&#x27;avg_bandwidth&#x27;] &gt; self.optimization_params[&#x27;target_bandwidth&#x27;]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            actions[&#x27;reduce_bandwidth&#x27;] = True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if self.optimization_params[&#x27;adaptive_frequency&#x27;]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                actions[&#x27;reduce_frequency&#x27;] = True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if self.optimization_params[&#x27;adaptive_compression&#x27;]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                actions[&#x27;increase_compression&#x27;] = True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Latency optimization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if current_metrics[&#x27;avg_latency&#x27;] &gt; self.optimization_params[&#x27;max_latency&#x27;]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            actions[&#x27;reduce_latency&#x27;] = True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if self.optimization_params[&#x27;adaptive_frequency&#x27;]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                actions[&#x27;increase_frequency&#x27;] = False  # Reduce frequency to reduce latency</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Compression optimization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if current_metrics[&#x27;avg_compression&#x27;] &lt; self.optimization_params[&#x27;min_compression_ratio&#x27;]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            actions[&#x27;improve_compression&#x27;] = True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return actions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def apply_optimizations(self, actions: Dict):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Apply optimization actions&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Apply frequency control</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if &#x27;reduce_frequency&#x27; in actions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            freq_msg = String()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            freq_msg.data = &#x27;reduce_frequency&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.frequency_publisher.publish(freq_msg)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Apply compression control</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if &#x27;increase_compression&#x27; in actions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            comp_msg = String()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            comp_msg.data = &#x27;increase_compression_level&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.compression_publisher.publish(comp_msg)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def get_optimization_summary(self) -&gt; Dict:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Get optimization summary&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        current_metrics = self.calculate_current_metrics()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;current_metrics&#x27;: current_metrics,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;optimization_enabled&#x27;: True,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;adaptive_frequency&#x27;: self.optimization_params[&#x27;adaptive_frequency&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;adaptive_compression&#x27;: self.optimization_params[&#x27;adaptive_compression&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;last_optimization_time&#x27;: time.time()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def main(args=None):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rclpy.init(args=args)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    optimizer = CommunicationOptimizer()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rclpy.spin(optimizer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    except KeyboardInterrupt:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        summary = optimizer.get_optimization_summary()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        print(f&quot;Optimization Summary: {summary}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    finally:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        optimizer.destroy_node()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rclpy.shutdown()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if __name__ == &#x27;__main__&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    main()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="communication-testing-and-validation">Communication Testing and Validation<a href="#communication-testing-and-validation" class="hash-link" aria-label="Direct link to Communication Testing and Validation" title="Direct link to Communication Testing and Validation" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-creating-communication-test-suite">1. Creating Communication Test Suite<a href="#1-creating-communication-test-suite" class="hash-link" aria-label="Direct link to 1. Creating Communication Test Suite" title="Direct link to 1. Creating Communication Test Suite" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat &gt; ~/isaac_sim_shared/scripts/communication_tests.py &lt;&lt; &#x27;EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#!/usr/bin/env python3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import rclpy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from rclpy.node import Node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from sensor_msgs.msg import Image, LaserScan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from geometry_msgs.msg import Twist</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from std_msgs.msg import String, Bool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import threading</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from typing import Dict, List</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import numpy as np</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class CommunicationTestSuite(Node):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def __init__(self):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        super().__init__(&#x27;communication_test_suite&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Test results</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.test_results = {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.test_running = False</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Communication statistics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.comm_stats = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;messages_sent&#x27;: 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;messages_received&#x27;: 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;latency_measurements&#x27;: [],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;bandwidth_measurements&#x27;: [],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;packet_loss_rate&#x27;: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Publishers for test messages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.image_publisher = self.create_publisher(Image, &#x27;/test/image&#x27;, 10)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.scan_publisher = self.create_publisher(LaserScan, &#x27;/test/scan&#x27;, 10)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.cmd_publisher = self.create_publisher(Twist, &#x27;/test/cmd_vel&#x27;, 10)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Subscribers for response messages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.response_subscriber = self.create_subscription(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;/test/response&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.response_callback,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Test control publishers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.test_status_publisher = self.create_publisher(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;/test/status&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.get_logger().info(&#x27;Communication Test Suite initialized&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def response_callback(self, msg):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Handle test response messages&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.comm_stats[&#x27;messages_received&#x27;] += 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def run_all_tests(self) -&gt; Dict:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Run all communication tests&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.get_logger().info(&#x27;Starting communication tests...&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        results = {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Test 1: Bandwidth capacity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        results[&#x27;bandwidth&#x27;] = self.test_bandwidth_capacity()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        time.sleep(1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Test 2: Latency measurement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        results[&#x27;latency&#x27;] = self.test_latency()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        time.sleep(1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Test 3: Message throughput</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        results[&#x27;throughput&#x27;] = self.test_message_throughput()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        time.sleep(1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Test 4: Packet loss rate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        results[&#x27;packet_loss&#x27;] = self.test_packet_loss_rate()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        time.sleep(1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Test 5: Connection stability</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        results[&#x27;stability&#x27;] = self.test_connection_stability()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        time.sleep(1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.get_logger().info(f&#x27;Communication tests completed: {results}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return results</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def test_bandwidth_capacity(self) -&gt; Dict:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Test maximum bandwidth capacity&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.get_logger().info(&#x27;Testing bandwidth capacity...&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        start_time = time.time()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        messages_sent = 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Send large messages to test bandwidth</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for i in range(100):  # Send 100 test messages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # Create a large image message</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            img_msg = Image()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            img_msg.header.stamp = self.get_clock().now().to_msg()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            img_msg.header.frame_id = &#x27;test&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            img_msg.width = 640</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            img_msg.height = 480</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            img_msg.encoding = &#x27;rgb8&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            img_msg.step = 640 * 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # Create large image data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            large_data = [i % 256 for _ in range(640 * 480 * 3)]  # RGB data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            img_msg.data = bytes(large_data)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.image_publisher.publish(img_msg)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            messages_sent += 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            time.sleep(0.01)  # Small delay between messages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        end_time = time.time()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        duration = end_time - start_time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        total_bytes = messages_sent * len(img_msg.data)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        bandwidth_mbps = (total_bytes * 8) / (duration * 1e6)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        result = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;bandwidth_mbps&#x27;: bandwidth_mbps,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;messages_sent&#x27;: messages_sent,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;duration&#x27;: duration,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;passed&#x27;: bandwidth_mbps &gt; 1.0  # Require at least 1 Mbps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.get_logger().info(f&#x27;BW test: {bandwidth_mbps:.2f} Mbps, Passed: {result[&quot;passed&quot;]}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def test_latency(self) -&gt; Dict:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Test message latency&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.get_logger().info(&#x27;Testing message latency...&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        latency_measurements = []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Send messages and measure round-trip time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for i in range(10):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            send_time = time.time()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # Send test message</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            test_msg = String()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            test_msg.data = f&#x27;test_latency_{i}_{send_time}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.test_status_publisher.publish(test_msg)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # Wait for response (simplified - in reality would use timestamps)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            time.sleep(0.1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # Record latency</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            recv_time = time.time()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            latency = recv_time - send_time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            latency_measurements.append(latency)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        avg_latency = sum(latency_measurements) / len(latency_measurements)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        max_latency = max(latency_measurements)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        result = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;avg_latency_ms&#x27;: avg_latency * 1000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;max_latency_ms&#x27;: max_latency * 1000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;measurements&#x27;: len(latency_measurements),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;passed&#x27;: avg_latency &lt; 0.1  # Require &lt; 100ms average</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.get_logger().info(f&#x27;Latency test: avg={avg_latency*1000:.2f}ms, Passed: {result[&quot;passed&quot;]}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def test_message_throughput(self) -&gt; Dict:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Test message throughput&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.get_logger().info(&#x27;Testing message throughput...&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        start_time = time.time()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        messages_sent = 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Send messages as fast as possible</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for i in range(1000):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            cmd_msg = Twist()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            cmd_msg.linear.x = float(i % 100) / 100.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            cmd_msg.angular.z = float(i % 100) / 100.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.cmd_publisher.publish(cmd_msg)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            messages_sent += 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        end_time = time.time()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        duration = end_time - start_time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        throughput = messages_sent / duration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        result = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;throughput_hz&#x27;: throughput,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;messages_sent&#x27;: messages_sent,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;duration&#x27;: duration,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;passed&#x27;: throughput &gt; 50.0  # Require at least 50 Hz throughput</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.get_logger().info(f&#x27;Throughput test: {throughput:.2f} Hz, Passed: {result[&quot;passed&quot;]}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def test_packet_loss_rate(self) -&gt; Dict:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Test packet loss rate&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.get_logger().info(&#x27;Testing packet loss rate...&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Send numbered messages and check which ones arrive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        total_sent = 100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        expected_responses = set(range(total_sent))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        received_responses = set()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for i in range(total_sent):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            test_msg = String()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            test_msg.data = f&#x27;ping_{i}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.test_status_publisher.publish(test_msg)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # In a real test, we&#x27;d wait for acknowledgment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # For simulation, we&#x27;ll just record what we expect</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if i % 2 == 0:  # Simulate 50% success rate for testing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                received_responses.add(i)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            time.sleep(0.01)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        lost_packets = total_sent - len(received_responses)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        loss_rate = lost_packets / total_sent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        result = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;total_sent&#x27;: total_sent,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;received&#x27;: len(received_responses),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;lost&#x27;: lost_packets,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;loss_rate&#x27;: loss_rate,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;passed&#x27;: loss_rate &lt; 0.1  # Require &lt; 10% loss rate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.get_logger().info(f&#x27;Loss test: {loss_rate*100:.2f}% loss, Passed: {result[&quot;passed&quot;]}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def test_connection_stability(self) -&gt; Dict:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Test connection stability over time&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.get_logger().info(&#x27;Testing connection stability...&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Simulate connection stability test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # In reality, this would involve monitoring connection status over time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        stability_score = 0.95  # Simulated high stability</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        result = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;stability_score&#x27;: stability_score,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;test_duration&#x27;: 10.0,  # seconds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;passed&#x27;: stability_score &gt; 0.9  # Require &gt; 90% stability</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.get_logger().info(f&#x27;Stability test: {stability_score*100:.2f}%, Passed: {result[&quot;passed&quot;]}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def get_test_summary(self) -&gt; Dict:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Get summary of all communication tests&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;timestamp&#x27;: time.time(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;total_tests&#x27;: len(self.test_results),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;passed_tests&#x27;: sum(1 for result in self.test_results.values() if result.get(&#x27;passed&#x27;, False)),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;test_results&#x27;: self.test_results,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;communication_stats&#x27;: self.comm_stats</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def main(args=None):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rclpy.init(args=args)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    test_suite = CommunicationTestSuite()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        results = test_suite.run_all_tests()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        summary = test_suite.get_test_summary()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        print(f&quot;Communication Test Summary: {summary}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    except Exception as e:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        print(f&quot;Error running communication tests: {e}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    finally:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        test_suite.destroy_node()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rclpy.shutdown()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if __name__ == &#x27;__main__&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    main()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="testing-and-validation">Testing and Validation<a href="#testing-and-validation" class="hash-link" aria-label="Direct link to Testing and Validation" title="Direct link to Testing and Validation" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-creating-communication-protocol-test-script">1. Creating Communication Protocol Test Script<a href="#1-creating-communication-protocol-test-script" class="hash-link" aria-label="Direct link to 1. Creating Communication Protocol Test Script" title="Direct link to 1. Creating Communication Protocol Test Script" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat &gt; ~/test_communication_protocols.sh &lt;&lt; &#x27;EOF&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Test script for AI-robot communication protocols</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;Testing AI-Robot Communication Protocols...&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Source ROS environment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source /opt/ros/humble/setup.bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source ~/isaac_ros_ws/install/setup.bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Check if communication protocol package is available</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;Checking communication protocol package...&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ros2 pkg list | grep communication_protocol</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if [ $? -eq 0 ]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;✓ Communication protocol package found&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;✗ Communication protocol package not found&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    exit 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Check for communication configuration files</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if [ -f &quot;/workspace/shared_dir/configs/communication_config.yaml&quot; ]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;✓ Communication configuration file found&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;✗ Communication configuration file not found&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    exit 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Build the communication protocol package</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;Building communication protocol package...&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd ~/isaac_ros_ws</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">colcon build --packages-select isaac_communication_protocol</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source install/setup.bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Check if launch files exist</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if [ -f &quot;/workspace/shared_dir/src/isaac_communication_protocol/launch/communication_protocol.launch.py&quot; ]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;✓ Communication protocol launch file found&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;✗ Communication protocol launch file not found&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    exit 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Test Python dependencies</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">python3 -c &quot;import numpy; import cv2; import pickle; import gzip; print(&#x27;✓ Required Python packages available&#x27;)&quot; || {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;✗ Required Python packages not available&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;Installing required packages...&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pip3 install numpy opencv-python</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;AI-Robot Communication Protocol test completed.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;To run the communication system, use:&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;ros2 launch isaac_communication_protocol communication_protocol.launch.py&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Make executable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chmod +x ~/test_communication_protocols.sh</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-running-communication-protocol-test">2. Running Communication Protocol Test<a href="#2-running-communication-protocol-test" class="hash-link" aria-label="Direct link to 2. Running Communication Protocol Test" title="Direct link to 2. Running Communication Protocol Test" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">~/test_communication_protocols.sh</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="troubleshooting-communication-protocols">Troubleshooting Communication Protocols<a href="#troubleshooting-communication-protocols" class="hash-link" aria-label="Direct link to Troubleshooting Communication Protocols" title="Direct link to Troubleshooting Communication Protocols" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="common-issues-and-solutions">Common Issues and Solutions<a href="#common-issues-and-solutions" class="hash-link" aria-label="Direct link to Common Issues and Solutions" title="Direct link to Common Issues and Solutions" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="issue-high-latency-in-communication-between-ai-and-robot">Issue: &quot;High latency in communication between AI and robot&quot;<a href="#issue-high-latency-in-communication-between-ai-and-robot" class="hash-link" aria-label="Direct link to Issue: &quot;High latency in communication between AI and robot&quot;" title="Direct link to Issue: &quot;High latency in communication between AI and robot&quot;" translate="no">​</a></h4>
<p><strong>Solution</strong>: Check QoS profiles and message frequency</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Check current QoS settings</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ros2 topic info /camera/color/image_raw</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ros2 topic info /cmd_vel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Verify message frequency</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ros2 topic hz /camera/color/image_raw</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ros2 topic hz /cmd_vel</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="issue-bandwidth-limitations-affecting-performance">Issue: &quot;Bandwidth limitations affecting performance&quot;<a href="#issue-bandwidth-limitations-affecting-performance" class="hash-link" aria-label="Direct link to Issue: &quot;Bandwidth limitations affecting performance&quot;" title="Direct link to Issue: &quot;Bandwidth limitations affecting performance&quot;" translate="no">​</a></h4>
<p><strong>Solution</strong>: Enable message compression and adjust frequency</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Check bandwidth usage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ros2 run isaac_communication_protocol communication_optimizer</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="issue-messages-not-being-delivered-consistently">Issue: &quot;Messages not being delivered consistently&quot;<a href="#issue-messages-not-being-delivered-consistently" class="hash-link" aria-label="Direct link to Issue: &quot;Messages not being delivered consistently&quot;" title="Direct link to Issue: &quot;Messages not being delivered consistently&quot;" translate="no">​</a></h4>
<p><strong>Solution</strong>: Check connection stability and retry mechanisms</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Monitor communication statistics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ros2 topic echo /communication/stats</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ros2 topic echo /communication/optimization_status</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="verification-checklist">Verification Checklist<a href="#verification-checklist" class="hash-link" aria-label="Direct link to Verification Checklist" title="Direct link to Verification Checklist" translate="no">​</a></h2>
<ul class="contains-task-list containsTaskList_mC6p">
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Communication protocol handler created and functional</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Message serialization and compression implemented</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Communication middleware created</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->QoS profiles configured appropriately</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Performance optimization tools implemented</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Communication test suite created</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Launch files created for communication system</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Configuration files created and validated</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Test script created and functional</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Troubleshooting guide reviewed</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="next-steps">Next Steps<a href="#next-steps" class="hash-link" aria-label="Direct link to Next Steps" title="Direct link to Next Steps" translate="no">​</a></h2>
<p>After implementing the AI-robot communication protocols:</p>
<ol>
<li class=""><strong>Test communication performance</strong> with Isaac Sim running</li>
<li class=""><strong>Validate message throughput and latency</strong> under various conditions</li>
<li class=""><strong>Optimize communication parameters</strong> based on performance metrics</li>
<li class=""><strong>Create communication exercises</strong> for students</li>
</ol>
<p>The AI-robot communication protocol framework is now configured and ready for Module 3, providing students with tools to establish efficient and reliable communication between AI systems and robotic platforms.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/chapter-3/communication-protocols.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/ur/docs/chapter-3/researcher-resources"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Researcher Resources: Module 3 - The AI-Robot Brain (NVIDIA Isaac™)</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/ur/docs/chapter-3/safety-framework"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Safety and Reliability Framework for Isaac Sim AI-Robot Systems</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#introduction-to-ai-robot-communication" class="table-of-contents__link toc-highlight">Introduction to AI-Robot Communication</a><ul><li><a href="#what-is-ai-robot-communication" class="table-of-contents__link toc-highlight">What is AI-Robot Communication?</a></li><li><a href="#key-communication-principles" class="table-of-contents__link toc-highlight">Key Communication Principles</a></li></ul></li><li><a href="#isaac-ros-communication-architecture" class="table-of-contents__link toc-highlight">Isaac ROS Communication Architecture</a><ul><li><a href="#1-creating-communication-protocol-configuration" class="table-of-contents__link toc-highlight">1. Creating Communication Protocol Configuration</a></li><li><a href="#2-creating-communication-protocol-node" class="table-of-contents__link toc-highlight">2. Creating Communication Protocol Node</a></li></ul></li><li><a href="#message-serialization-and-compression" class="table-of-contents__link toc-highlight">Message Serialization and Compression</a><ul><li><a href="#1-creating-message-serialization-utilities" class="table-of-contents__link toc-highlight">1. Creating Message Serialization Utilities</a></li></ul></li><li><a href="#communication-middleware-integration" class="table-of-contents__link toc-highlight">Communication Middleware Integration</a><ul><li><a href="#1-creating-communication-middleware" class="table-of-contents__link toc-highlight">1. Creating Communication Middleware</a></li></ul></li><li><a href="#communication-protocol-launch-files" class="table-of-contents__link toc-highlight">Communication Protocol Launch Files</a><ul><li><a href="#1-creating-communication-protocol-package" class="table-of-contents__link toc-highlight">1. Creating Communication Protocol Package</a></li><li><a href="#2-creating-setup-files-for-communication-package" class="table-of-contents__link toc-highlight">2. Creating Setup Files for Communication Package</a></li><li><a href="#3-creating-communication-protocol-launch-file" class="table-of-contents__link toc-highlight">3. Creating Communication Protocol Launch File</a></li></ul></li><li><a href="#communication-performance-optimization" class="table-of-contents__link toc-highlight">Communication Performance Optimization</a><ul><li><a href="#1-creating-performance-optimization-tools" class="table-of-contents__link toc-highlight">1. Creating Performance Optimization Tools</a></li></ul></li><li><a href="#communication-testing-and-validation" class="table-of-contents__link toc-highlight">Communication Testing and Validation</a><ul><li><a href="#1-creating-communication-test-suite" class="table-of-contents__link toc-highlight">1. Creating Communication Test Suite</a></li></ul></li><li><a href="#testing-and-validation" class="table-of-contents__link toc-highlight">Testing and Validation</a><ul><li><a href="#1-creating-communication-protocol-test-script" class="table-of-contents__link toc-highlight">1. Creating Communication Protocol Test Script</a></li><li><a href="#2-running-communication-protocol-test" class="table-of-contents__link toc-highlight">2. Running Communication Protocol Test</a></li></ul></li><li><a href="#troubleshooting-communication-protocols" class="table-of-contents__link toc-highlight">Troubleshooting Communication Protocols</a><ul><li><a href="#common-issues-and-solutions" class="table-of-contents__link toc-highlight">Common Issues and Solutions</a></li></ul></li><li><a href="#verification-checklist" class="table-of-contents__link toc-highlight">Verification Checklist</a></li><li><a href="#next-steps" class="table-of-contents__link toc-highlight">Next Steps</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Chapters</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/ur/docs/intro">Introduction</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/physical-ai-book/hackathon-book/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Discussions<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/ur/docs/contributing">Contributing</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/ur/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/physical-ai-book/hackathon-book" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 AI-Native Textbook for Physical AI & Humanoid Robotics. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>